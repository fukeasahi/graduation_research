## 聞きたいことの一行まとめ
- それぞれの散布図の外れ値についてお聞きしたいです。
- また、外れ値を外した後の処理についても相談したいです。

## 起きている問題（起きている現象の詳細/エラーコード/スクリーンショット）
- 散布図の結果は、「散布図結果」フォルダに格納しています。

## ソースコード（関連するソースコード/全ソースコード）
```
import pandas as pd
import statsmodels.formula.api as smf
import matplotlib.pyplot as plt

# データの読み込みとデータの整形
data = pd.read_excel("/content/data.xlsx", sheet_name="data").drop(['Unnamed: 0', 'date'], axis=1)

# 基本統計量
print(data.describe())

# 相関行列
print(data.corr(method='pearson'))

# 散布図
explanatory_variables = { "average_temperature": "(℃)", "total_precipitation": "(mm)", "sunlight_hours": "(h)", "quantity": "(t)" }
TARGET_VARIABLE = "yen_kg"

for key, value,  in explanatory_variables.items():
  explanatory_variable = data[key]
  target_variable = data[TARGET_VARIABLE]
  plt.scatter(explanatory_variable, data[TARGET_VARIABLE])
  plt.title(f"Scatterplot of {key} and {TARGET_VARIABLE}")
  plt.xlabel(key + value)
  plt.ylabel(TARGET_VARIABLE)
  plt.grid(True)
  plt.show()
  print("corr", target_variable.corr(explanatory_variable))

# 重回帰分析
formula = f"{TARGET_VARIABLE} ~ {' + '.join(explanatory_variables.keys())}"
results = smf.ols(formula, data).fit()
results.summary()
```

## 問題解決するために試したこと（コードもあれば追記）
- 「散布図結果」フォルダのyen_kgとtotal_precipitationの散布図で赤丸したところが外れ値かなと考えています。
- それ以外は、外れ値がないのではないかなと考えています。
- total_precipitationが外れていない行を抽出して、もう一度重回帰分析をしてみました。

```
import pandas as pd
import statsmodels.formula.api as smf
import matplotlib.pyplot as plt

# データの読み込みとデータの整形
data = pd.read_excel("/content/data.xlsx", sheet_name="data").drop(['Unnamed: 0', 'date'], axis=1)
data = data[data["total_precipitation"] <= 400]

# 基本統計量
print(data.describe())

# 相関行列
print(data.corr(method='pearson'))

# 散布図
explanatory_variables = { "average_temperature": "(℃)", "total_precipitation": "(mm)", "sunlight_hours": "(h)", "quantity": "(t)" }
TARGET_VARIABLE = "yen_kg"

for key, value,  in explanatory_variables.items():
  explanatory_variable = data[key]
  target_variable = data[TARGET_VARIABLE]
  plt.scatter(explanatory_variable, data[TARGET_VARIABLE])
  plt.title(f"Scatterplot of {key} and {TARGET_VARIABLE}")
  plt.xlabel(key + value)
  plt.ylabel(TARGET_VARIABLE)
  plt.grid(True)
  plt.show()
  print("corr", target_variable.corr(explanatory_variable))

# 重回帰分析
formula = f"{TARGET_VARIABLE} ~ {' + '.join(explanatory_variables.keys())}"
results = smf.ols(formula, data).fit()
results.summary()
```

```
OLS Regression Results
Dep. Variable:	yen_kg	R-squared:	0.189
Model:	OLS	Adj. R-squared:	0.166
Method:	Least Squares	F-statistic:	8.060
Date:	Thu, 26 May 2022	Prob (F-statistic):	7.18e-06
Time:	03:16:56	Log-Likelihood:	-798.18
No. Observations:	143	AIC:	1606.
Df Residuals:	138	BIC:	1621.
Df Model:	4		
Covariance Type:	nonrobust		
coef	std err	t	P>|t|	[0.025	0.975]
Intercept	264.1099	41.038	6.436	0.000	182.965	345.255
average_temperature	-2.3860	0.942	-2.534	0.012	-4.248	-0.524
total_precipitation	-0.2178	0.132	-1.653	0.101	-0.478	0.043
sunlight_hours	-0.1596	0.184	-0.869	0.386	-0.523	0.204
quantity	-0.0041	0.024	-0.166	0.868	-0.052	0.044
Omnibus:	36.376	Durbin-Watson:	1.129
Prob(Omnibus):	0.000	Jarque-Bera (JB):	59.285
Skew:	1.249	Prob(JB):	1.34e-13
Kurtosis:	4.927	Cond. No.	7.53e+03


Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 7.53e+03. This might indicate that there are
strong multicollinearity or other numerical problems.
```


## 問題について自分なりに考えたこと（デバッグ結果/検索結果/自分なりの原因予想）
- Adj. R-squared:	0.167 -> 	0.166、少し説明力が下がりましたか？
- P>|t|
  - average_temperature 0.006 -> 0.012
  - total_precipitation 0.095	-> 0.101
  - sunlight_hours 0.422 -> 0.386
  - quantity 0.849 -> 0.868
  - sunlight_hoursは若干有意になったが、他は、若干有意ではなくなったのかな？

お手数をおかけしますが、ご教授よろしくお願いいたします。
